#!/usr/bin/bash -e

ROOT=$(git rev-parse --show-toplevel)
HEADER=$(cat<<EOM
/**
 * THIS IS CODE-GENERATED by scripts/prebuild.sh
 * DO NOT EDIT!
 **/
EOM
)


cd $ROOT

#######################################################################################################

echo Generating 'src/descriptor.ts'
cat << EOF > src/descriptor.ts
${HEADER}

/* eslint-disable @typescript-eslint/no-explicit-any */
/* eslint-disable @typescript-eslint/no-extraneous-class */
/* eslint-disable @typescript-eslint/no-unused-vars */

$(npx quicktype --lang ts --src-lang schema docs/schema/descriptor.json --nice-property-names)
EOF

#######################################################################################################

echo Generating 'src/constants.ts'
cat << EOF > src/constants.ts
${HEADER}

/* eslint-disable @typescript-eslint/no-extraneous-class */

export class Constants {
  static readonly AUTHOR: string = '$(node -p "require('./package.json').author")';
  static readonly DESCRIPTION: string = '$(node -p "require('./package.json').description")';
  static readonly HOMEPAGE: string = '$(node -p "require('./package.json').homepage")';
  static readonly LICENSE: string = '$(node -p "require('./package.json').license")';
  static readonly NAME: string = '$(node -p "require('./package.json').name")';
  static readonly RELEASED_DATE: string = '$(node -p "(new Date()).toUTCString()")';
  static readonly RELEASED_YEAR: number = $(node -p "(new Date()).getUTCFullYear()");
  static readonly VERSION: string = '$(node -p "require('./package.json').version")';
}
EOF

#######################################################################################################
